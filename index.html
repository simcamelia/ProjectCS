<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Meteo App ‚Äì Camelia Simion</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
  <style>
    :root{
      --card:#ffffff;--bg:#f6f8fb;--text:#0f172a;--muted:#64748b;--accent:#2563eb;--danger:#ef4444;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      background:var(--bg);color:var(--text);
      display:flex;align-items:center;justify-content:center;padding:24px;
    }
    .app{width:100%;max-width:960px}
    .card{
      background:var(--card);border-radius:16px;box-shadow:0 10px 30px rgba(2,6,23,.06);
      overflow:hidden;border:1px solid #e5e7eb;
    }
    header{
      display:flex;gap:12px;align-items:center;justify-content:space-between;padding:16px 20px;border-bottom:1px solid #eef2f7
    }
    form{
      display:flex;gap:8px;flex:1
    }
    input[type="search"]{
      flex:1;padding:12px 14px;border:1px solid #e5e7eb;border-radius:12px;font-size:16px;
      outline:none;transition:border .15s, box-shadow .15s;background:#fff
    }
    input[type="search"]:focus{border-color:var(--accent);box-shadow:0 0 0 4px rgba(37,99,235,.12)}
    .btn{
      padding:12px 14px;border-radius:12px;border:1px solid #e5e7eb;background:#fff;cursor:pointer;font-weight:600
    }
    .btn.primary{background:var(--accent);border-color:var(--accent);color:white}
    .btn.ghost{background:#fff}
    .btn:disabled{opacity:.6;cursor:not-allowed}

    .content{display:grid;grid-template-columns:1.2fr .8fr;gap:16px;padding:20px}
    @media (max-width:820px){.content{grid-template-columns:1fr}}

    .current{padding:20px;border:1px solid #eef2f7;border-radius:14px}
    .city-row{display:flex;align-items:center;gap:10px;margin-bottom:6px}
    .city{font-size:28px;font-weight:800}
    .date{color:var(--muted);font-size:14px}
    .weather-row{display:flex;align-items:center;gap:18px;margin-top:14px}
    .temp{font-size:64px;font-weight:800;letter-spacing:-1px}
    .units{display:flex;gap:8px;align-items:flex-start;margin-left:6px}
    .unit{color:var(--muted);font-weight:600;cursor:pointer}
    .unit.active{color:var(--text)}
    .desc{font-weight:600;text-transform:capitalize}
    .meta{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:10px;margin-top:14px}
    .meta div{background:#f8fafc;border:1px solid #eef2f7;padding:10px;border-radius:10px;font-size:14px}

    .side{display:grid;gap:16px}

    .forecast{border:1px solid #eef2f7;border-radius:14px;padding:14px}
    .forecast h3{margin:0 0 8px 0;font-size:16px}
    .days{display:grid;grid-template-columns:repeat(6,1fr);gap:8px}
    @media (max-width:820px){.days{grid-template-columns:repeat(3,1fr)}}
    .day{background:#fff;border:1px solid #eef2f7;border-radius:12px;padding:10px;text-align:center}
    .day .name{font-weight:700}
    .day .t{font-size:14px;margin-top:6px}

    .error{color:var(--danger);font-weight:600;margin:8px 0}
    footer{padding:14px 18px;border-top:1px solid #eef2f7;font-size:14px;color:var(--muted)}
    footer a{color:var(--accent);text-decoration:none;font-weight:600}
  </style>
</head>
<body>
  <div class="app">
    <div class="card">
      <header>
        <form id="search-form">
          <input id="query" type="search" placeholder="Search for a city‚Ä¶ (e.g. Sydney)" autocomplete="off" />
          <button class="btn primary" type="submit">Search</button>
        </form>
        <button class="btn ghost" id="geo-btn" title="Use my location">üìç</button>
      </header>

      <div class="content">
        <section class="current">
          <div class="city-row">
            <div class="city" id="city">‚Äî</div>
          </div>
          <div class="date" id="date">‚Äî</div>

          <div class="weather-row">
            <img id="icon" alt="" width="84" height="84" />
            <div class="temp" id="temp">‚Äì</div>
            <div class="units">
              <span class="unit" id="c">¬∞C</span>
              <span class="unit">|</span>
              <span class="unit" id="f">¬∞F</span>
            </div>
          </div>
          <div class="desc" id="desc">‚Äî</div>
          <div class="meta">
            <div>Humidity: <strong id="humidity">‚Äî</strong>%</div>
            <div>Wind: <strong id="wind">‚Äî</strong> m/s</div>
          </div>
          <div class="error" id="error" aria-live="polite"></div>
        </section>

        <aside class="side">
          <div class="forecast">
            <h3>6‚ÄëDay Forecast</h3>
            <div class="days" id="forecast"></div>
          </div>
        </aside>
      </div>

      <footer>
        This project was coded by Camelia Simion, is open-sourced on
        <a href="https://github.com/simcamelia/ProjectCS/tree/main" target="_blank" rel="noopener">Github</a>
        and hosted on
        <a href="https://simcam.netlify.app/" target="_blank" rel="noopener">Netlify</a>.
      </footer>
    </div>
  </div>

  <script>
    // === Configuration ===
    const OPENWEATHER_KEY = "YOUR_OPENWEATHER_API_KEY"; // ‚Üê replace with your key
    const ENDPOINT_CURRENT = (q)=>`https://api.openweathermap.org/data/2.5/weather?q=${encodeURIComponent(q)}&appid=${OPENWEATHER_KEY}&units=metric`;
    const ENDPOINT_CURRENT_COORD = (lat,lon)=>`https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&appid=${OPENWEATHER_KEY}&units=metric`;
    const ENDPOINT_FORECAST = (q)=>`https://api.openweathermap.org/data/2.5/forecast?q=${encodeURIComponent(q)}&appid=${OPENWEATHER_KEY}&units=metric`;

    // === Elements ===
    const elCity = document.getElementById('city');
    const elDate = document.getElementById('date');
    const elIcon = document.getElementById('icon');
    const elTemp = document.getElementById('temp');
    const elDesc = document.getElementById('desc');
    const elHumidity = document.getElementById('humidity');
    const elWind = document.getElementById('wind');
    const elForecast = document.getElementById('forecast');
    const elError = document.getElementById('error');
    const form = document.getElementById('search-form');
    const input = document.getElementById('query');
    const cBtn = document.getElementById('c');
    const fBtn = document.getElementById('f');
    const geoBtn = document.getElementById('geo-btn');

    let state = { tempC: null, unit: 'C', city: null };

    function formatDate(dt){
      const d = new Date(dt*1000);
      return d.toLocaleString(undefined,{weekday:'long', hour:'2-digit', minute:'2-digit', day:'numeric', month:'short'});
    }
    function iconUrl(code){
      return `https://openweathermap.org/img/wn/${code}@2x.png`;
    }
    function setUnits(active){
      state.unit = active;
      cBtn.classList.toggle('active', active==='C');
      fBtn.classList.toggle('active', active==='F');
      if(state.tempC!=null){
        elTemp.textContent = active==='C' ? Math.round(state.tempC) + '¬∞' : Math.round(state.tempC*9/5+32) + '¬∞';
      }
    }
    function showError(msg){
      elError.textContent = msg || '';
    }

    async function fetchJSON(url){
      const res = await fetch(url);
      if(!res.ok) throw new Error(`HTTP ${res.status}`);
      return res.json();
    }

    async function loadCity(q){
      try{
        showError('');
        elCity.textContent = 'Loading‚Ä¶';
        elDesc.textContent = '‚Äî';
        elTemp.textContent = '‚Äì';
        elIcon.src = '';
        const [current, forecast] = await Promise.all([
          fetchJSON(ENDPOINT_CURRENT(q)),
          fetchJSON(ENDPOINT_FORECAST(q))
        ]);
        renderCurrent(current);
        renderForecast(forecast);
      }catch(err){
        console.error(err);
        showError('City not found. Try another search.');
        elCity.textContent = '‚Äî';
      }
    }

    function renderCurrent(data){
      state.city = `${data.name}, ${data.sys?.country ?? ''}`.trim();
      elCity.textContent = state.city;
      elDate.textContent = formatDate(data.dt);
      const w = data.weather?.[0];
      elDesc.textContent = w?.description || '‚Äî';
      elIcon.src = w ? iconUrl(w.icon) : '';
      elIcon.alt = w?.main || '';
      state.tempC = data.main?.temp ?? null;
      setUnits(state.unit);
      elHumidity.textContent = Math.round(data.main?.humidity ?? 0);
      elWind.textContent = (data.wind?.speed ?? 0).toFixed(1);
    }

    function groupDailyFrom3h(list){
      // group by date (local to item timezone not available; use UTC date)
      const byDay = new Map();
      list.forEach(item=>{
        const d = new Date(item.dt*1000);
        const key = d.getUTCFullYear()+"-"+(d.getUTCMonth()+1)+"-"+d.getUTCDate();
        if(!byDay.has(key)) byDay.set(key,[]);
        byDay.get(key).push(item);
      });
      // pick around midday sample where available, else average
      const days = [];
      for(const [k, arr] of byDay){
        let pick = arr.reduce((best,it)=>{
          const hour = new Date(it.dt*1000).getUTCHours();
          const score = Math.abs(12-hour);
          return (best==null || score < best.score) ? {it, score} : best;
        }, null)?.it;
        if(!pick){ pick = arr[Math.floor(arr.length/2)]; }
        const min = Math.min(...arr.map(a=>a.main.temp_min));
        const max = Math.max(...arr.map(a=>a.main.temp_max));
        days.push({ dt: pick.dt, icon: pick.weather?.[0]?.icon, min, max });
      }
      // return next 6 excluding today
      const todayKey = new Date().getUTCFullYear()+"-"+(new Date().getUTCMonth()+1)+"-"+new Date().getUTCDate();
      return days
        .filter(d=>{
          const dd = new Date(d.dt*1000);
          const key = dd.getUTCFullYear()+"-"+(dd.getUTCMonth()+1)+"-"+dd.getUTCDate();
          return key !== todayKey;
        })
        .slice(0,6);
    }

    function renderForecast(data){
      const days = groupDailyFrom3h(data.list || []);
      elForecast.innerHTML = days.map(d=>{
        const name = new Date(d.dt*1000).toLocaleDateString(undefined,{weekday:'short'});
        return `<div class="day">
          <div class="name">${name}</div>
          <img src="${iconUrl(d.icon)}" alt="" width="60" height="60" />
          <div class="t">${Math.round(d.max)}¬∞ / ${Math.round(d.min)}¬∞</div>
        </div>`;
      }).join('');
    }

    // === Events ===
    form.addEventListener('submit', (e)=>{
      e.preventDefault();
      const q = input.value.trim();
      if(q) loadCity(q);
    });
    cBtn.addEventListener('click', ()=> setUnits('C'));
    fBtn.addEventListener('click', ()=> setUnits('F'));

    geoBtn.addEventListener('click', async ()=>{
      if(!navigator.geolocation){ showError('Geolocation not supported.'); return; }
      showError('');
      elCity.textContent = 'Locating‚Ä¶';
      navigator.geolocation.getCurrentPosition(async (pos)=>{
        try{
          const {latitude:lat, longitude:lon} = pos.coords;
          const current = await fetchJSON(ENDPOINT_CURRENT_COORD(lat,lon));
          renderCurrent(current);
          // for forecast, use name we just resolved
          if(current.name) {
            const forecast = await fetchJSON(ENDPOINT_FORECAST(current.name));
            renderForecast(forecast);
          }
        }catch(err){
          console.error(err); showError('Could not get your local weather.');
        }
      }, (err)=>{
        showError('Location permission denied.');
      }, {enableHighAccuracy:false, timeout:8000});
    });

    // Initial city
    loadCity('London');
  </script>
</body>
</html>

