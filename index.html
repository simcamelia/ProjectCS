<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Meteo App ‚Äì Camelia Simion</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
  <style>
    :root{
      --card:#ffffff;--bg:#f6f8fb;--text:#0f172a;--muted:#64748b;--accent:#2563eb;--danger:#ef4444;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      background:var(--bg);color:var(--text);
      display:flex;align-items:center;justify-content:center;padding:24px;
    }
    .app{width:100%;max-width:960px}
    .card{
      background:var(--card);border-radius:16px;box-shadow:0 10px 30px rgba(2,6,23,.06);
      overflow:hidden;border:1px solid #e5e7eb;
    }
    header{
      display:flex;gap:12px;align-items:center;justify-content:space-between;padding:16px 20px;border-bottom:1px solid #eef2f7
    }
    form{
      display:flex;gap:8px;flex:1
    }
    input[type="search"]{
      flex:1;padding:12px 14px;border:1px solid #e5e7eb;border-radius:12px;font-size:16px;
      outline:none;transition:border .15s, box-shadow .15s;background:#fff
    }
    input[type="search"]:focus{border-color:var(--accent);box-shadow:0 0 0 4px rgba(37,99,235,.12)}
    .btn{
      padding:12px 14px;border-radius:12px;border:1px solid #e5e7eb;background:#fff;cursor:pointer;font-weight:600
    }
    .btn.primary{background:var(--accent);border-color:var(--accent);color:white}
    .btn.ghost{background:#fff}
    .btn:disabled{opacity:.6;cursor:not-allowed}

    .content{display:grid;grid-template-columns:1.2fr .8fr;gap:16px;padding:20px}
    @media (max-width:820px){.content{grid-template-columns:1fr}}

    .current{padding:20px;border:1px solid #eef2f7;border-radius:14px}
    .city-row{display:flex;align-items:center;gap:10px;margin-bottom:6px}
    .city{font-size:28px;font-weight:800}
    .date{color:var(--muted);font-size:14px}
    .weather-row{display:flex;align-items:center;gap:18px;margin-top:14px}
    .temp{font-size:64px;font-weight:800;letter-spacing:-1px}
    .units{display:flex;gap:8px;align-items:flex-start;margin-left:6px}
    .unit{color:var(--muted);font-weight:600;cursor:pointer}
    .unit.active{color:var(--text)}
    .desc{font-weight:600;text-transform:capitalize;display:flex;align-items:center;gap:8px;font-size:18px}
    .meta{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:10px;margin-top:14px}
    .meta div{background:#f8fafc;border:1px solid #eef2f7;padding:10px;border-radius:10px;font-size:14px}

    .side{display:grid;gap:16px}

    .forecast{border:1px solid #eef2f7;border-radius:14px;padding:14px}
    .forecast h3{margin:0 0 8px 0;font-size:16px}
    .days{display:grid;grid-template-columns:repeat(6,1fr);gap:8px}
    @media (max-width:820px){.days{grid-template-columns:repeat(3,1fr)}}
    .day{background:#fff;border:1px solid #eef2f7;border-radius:12px;padding:10px;text-align:center}
    .day .name{font-weight:700}
    .day .t{font-size:14px;margin-top:6px}

    .error{color:var(--danger);font-weight:600;margin:8px 0}
    footer{padding:14px 18px;border-top:1px solid #eef2f7;font-size:14px;color:var(--muted)}
    footer a{color:var(--accent);text-decoration:none;font-weight:600}
  </style>
</head>
<body>
  <div class="app">
    <div class="card">
      <header>
        <form id="search-form">
          <input id="query" type="search" placeholder="Search for a city‚Ä¶ (e.g. Sydney)" autocomplete="off" />
          <button class="btn primary" type="submit">Search</button>
        </form>
        <button class="btn ghost" id="geo-btn" title="Use my location">üìç</button>
      </header>

      <div class="content">
        <section class="current">
          <div class="city-row">
            <div class="city" id="city">‚Äî</div>
          </div>
          <div class="date" id="date">‚Äî</div>

          <div class="weather-row">
            <div class="temp" id="temp">‚Äì</div>
            <div class="units">
              <span class="unit" id="c">¬∞C</span>
              <span class="unit">|</span>
              <span class="unit" id="f">¬∞F</span>
            </div>
          </div>
          <div class="desc"><img id="icon" alt="" width="40" height="40" /><span id="desc">‚Äî</span></div>
          <div class="meta">
            <div>Humidity: <strong id="humidity">‚Äî</strong>%</div>
            <div>Wind: <strong id="wind">‚Äî</strong> m/s</div>
          </div>
          <div class="error" id="error" aria-live="polite"></div>
        </section>

        <aside class="side">
          <div class="forecast">
            <h3>6‚ÄëDay Forecast</h3>
            <div class="days" id="forecast"></div>
          </div>
        </aside>
      </div>

      <footer>
        This project was coded by Camelia Simion, is open-sourced on
        <a href="https://github.com/simcamelia/ProjectCS/tree/main" target="_blank" rel="noopener">Github</a>
        and hosted on
        <a href="https://simcam.netlify.app/" target="_blank" rel="noopener">Netlify</a>.
      </footer>
    </div>
  </div>

  <script>
    const GEO = (q)=>`https://geocoding-api.open-meteo.com/v1/search?name=${encodeURIComponent(q)}&count=1&language=en&format=json`;
    const FORE = (lat, lon)=>`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current=temperature_2m,relative_humidity_2m,wind_speed_10m,weather_code&daily=weather_code,temperature_2m_max,temperature_2m_min&timezone=auto&forecast_days=7`;

    const elCity = document.getElementById('city');
    const elDate = document.getElementById('date');
    const elIcon = document.getElementById('icon');
    const elTemp = document.getElementById('temp');
    const elDesc = document.getElementById('desc');
    const elHumidity = document.getElementById('humidity');
    const elWind = document.getElementById('wind');
    const elForecast = document.getElementById('forecast');
    const elError = document.getElementById('error');
    const form = document.getElementById('search-form');
    const input = document.getElementById('query');
    const cBtn = document.getElementById('c');
    const fBtn = document.getElementById('f');
    const geoBtn = document.getElementById('geo-btn');

    let state = { tempC: null, unit: 'C', city: null, coords: null };

    function formatDate(ts){
      const d = new Date(ts);
      return d.toLocaleString(undefined,{weekday:'long', hour:'2-digit', minute:'2-digit', day:'numeric', month:'short'});
    }

    function codeToIcon(code){
      // Using OpenWeather icons for simplicity
      const map = {
        0: "01d", // clear
        1: "02d", // partly cloudy
        2: "03d", // cloudy
        3: "04d", // overcast
        45: "50d", 48: "50d", // fog
        51: "09d", 53: "09d", 55: "09d", // drizzle
        61: "10d", 63: "10d", 65: "10d", // rain
        66: "10d", 67: "10d", // freezing rain
        71: "13d", 73: "13d", 75: "13d", // snow
        77: "13d",
        80: "09d", 81: "09d", 82: "09d", // showers
        85: "13d", 86: "13d", // snow showers
        95: "11d", 96: "11d", 99: "11d" // thunderstorms
      };
      return map[code] || "01d";
    }

    function codeToText(code){
      const map = {
        0: "Clear",
        1: "Mainly clear",
        2: "Partly cloudy",
        3: "Cloudy",
        45: "Fog",
        48: "Rime fog",
        51: "Light drizzle",
        53: "Drizzle",
        55: "Dense drizzle",
        61: "Light rain",
        63: "Rain",
        65: "Heavy rain",
        66: "Freezing rain",
        67: "Freezing rain",
        71: "Light snow",
        73: "Snow",
        75: "Heavy snow",
        77: "Snow grains",
        80: "Light showers",
        81: "Showers",
        82: "Heavy showers",
        85: "Snow showers",
        86: "Snow showers",
        95: "Thunderstorm",
        96: "Thunderstorm with hail",
        99: "Thunderstorm with hail"
      };
      return map[code] || "Weather";
    }

    function showError(msg=''){ elError.textContent = msg; }

    async function fetchJSON(url){
      const res = await fetch(url);
      if(!res.ok) throw new Error(`HTTP ${res.status}`);
      return res.json();
    }

    async function loadByCoords(lat, lon, label){
      try{
        showError('');
        elCity.textContent = label || 'Loading‚Ä¶';
        elDesc.textContent = '‚Äî';
        elTemp.textContent = '‚Äì';
        elIcon.src = '';

        const data = await fetchJSON(FORE(lat, lon));
        renderCurrentFromForecast(data, label);
        renderForecast(data);
      }catch(err){
        console.error(err);
        showError('Could not load weather for those coordinates.');
        elCity.textContent = '‚Äî';
      }
    }

    async function loadCity(q){
      try{
        showError('');
        elCity.textContent = 'Searching‚Ä¶';
        const geo = await fetchJSON(GEO(q));
        if(!geo || !geo.results || geo.results.length === 0){
          showError('City not found. Try another search.');
          elCity.textContent = '‚Äî';
          return;
        }
        const g = geo.results[0];
        const label = `${g.name}${g.admin1 ? ', ' + g.admin1 : ''}${g.country ? ', ' + g.country : ''}`;
        state.coords = {lat: g.latitude, lon: g.longitude};
        await loadByCoords(g.latitude, g.longitude, label);
      }catch(err){
        console.error(err);
        showError('City not found. Try another search.');
        elCity.textContent = '‚Äî';
      }
    }

    function setUnits(active){
      state.unit = active;
      cBtn.classList.toggle('active', active==='C');
      fBtn.classList.toggle('active', active==='F');
      if(state.tempC!=null){
        elTemp.textContent = active==='C' ? Math.round(state.tempC) + '¬∞' : Math.round(state.tempC*9/5+32) + '¬∞';
      }
    }

    function renderCurrentFromForecast(data, label){
      state.city = label || '‚Äî';
      elCity.textContent = state.city;
      elDate.textContent = formatDate(Date.now());
      const current = data.current;
      const code = current.weather_code;
      elDesc.textContent = codeToText(code);
      elIcon.src = `https://openweathermap.org/img/wn/${codeToIcon(code)}@2x.png`;
      elIcon.alt = elDesc.textContent;
      state.tempC = current.temperature_2m ?? null;
      setUnits(state.unit);
      elHumidity.textContent = Math.round(current.relative_humidity_2m ?? 0);
      elWind.textContent = (current.wind_speed_10m ?? 0).toFixed(1);
    }

    function renderForecast(data){
      const daily = data.daily;
      const days = [];
      for(let i=1; i<Math.min(daily.time.length,7); i++){
        days.push({
          ts: new Date(daily.time[i]).getTime(),
          code: daily.weather_code[i],
          min: daily.temperature_2m_min[i],
          max: daily.temperature_2m_max[i]
        });
      }
      elForecast.innerHTML = days.map(d=>{
        const name = new Date(d.ts).toLocaleDateString(undefined,{weekday:'short'});
        return `<div class="day">
          <div class="name">${name}</div>
          <img src="https://openweathermap.org/img/wn/${codeToIcon(d.code)}@2x.png" alt="${codeToText(d.code)}" width="50" height="50" />
          <div class="t">${Math.round(d.max)}¬∞ / ${Math.round(d.min)}¬∞</div>
        </div>`;
      }).join('');
    }

    form.addEventListener('submit', (e)=>{
      e.preventDefault();
      const q = input.value.trim();
      if(q) loadCity(q);
    });
    cBtn.addEventListener('click', ()=> setUnits('C'));
    fBtn.addEventListener('click', ()=> setUnits('F'));

    geoBtn.addEventListener('click', ()=>{
      if(!navigator.geolocation){ showError('Geolocation not supported.'); return; }
      elCity.textContent = 'Locating‚Ä¶';
      navigator.geolocation.getCurrentPosition((pos)=>{
        const {latitude:lat, longitude:lon} = pos.coords;
        state.coords = {lat, lon};
        loadByCoords(lat, lon, 'My location');
      }, ()=> showError('Location permission denied.'), {enableHighAccuracy:false, timeout:8000});
    });

    loadCity('London');
  </script>
</body>
</html>

